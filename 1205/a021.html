<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¸¬é©—çµæœ</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body onload="initial();" class="bg-light">
    <!-- <button onclick = "read_the_content();">é»æˆ‘</button> -->
    <span id = "content_one" style = "display: none;">ä½ å¥½</span>
    <div class="container mt-5">
        <div class="card shadow-sm">
            <div class="card-body">
                <h3 class="card-title text-center">ä½œç­”å›é¡§</h3>
                <h3 class="card-title text-center" id = "user_name"></h3>
                <h3 class="card-title text-center" id = "user_id"></h3>

                <p id="user_time" class="text-primary text-center fw-bold"></p>
                <p id="error_problem_show" class="text-danger text-center fw-bold"></p>
            </div>
        </div>
    </div>
    <button style="float: right;" class="btn btn-primary" onclick = "window.location.href = 'a013.html'">è¿”å›ä¸»é¸å–®</button>

    <script>
        let content_total = "";
        function initial(){
            let user_name = localStorage.getItem("new_user_name");
            // alert(user_name);
            let user_id = localStorage.getItem("user_id");
            document.getElementById("user_name").innerHTML = `å§“åï¼š${user_name}<br>`;
            document.getElementById("user_id").innerHTML = `åº§è™Ÿ:${user_id}<br>`;
            let seconds = parseInt(localStorage.getItem("seconds")) || 0;
            let minutes = parseInt(localStorage.getItem("minutes")) || 0;
            let timeInput = parseInt(localStorage.getItem("timeInput")) || 0;
            // let name = localStorage.getItem("name") || "ä½¿ç”¨è€…";
            let error_store = [];
            let correct_store = localStorage.getItem("correct_store") || "";
            let problem_counter = localStorage.getItem("problem_counter");
            // alert(`ç¸½é¡Œæ•¸${problem_counter}`);
           
           for(let i = 1; i <= problem_counter; i++){
                if(!correct_store.includes(i)){
                    error_store.push(i);
                }
           }

            let error_show = "ç¬¬ ";

            for(let i = 0; i < error_store.length; i++){
                error_show += `${error_store[i]} `;
            }
            error_show += `é¡Œ`;
            

            timeInput *= 60;
            let total = minutes * 60 + seconds;
            total = timeInput - total;

            let new_minutes = 0;
            let new_seconds = 0;
            let string = "";
            
            
            if(total >= 60){
                new_minutes = Math.floor(total / 60);
                new_seconds = total - new_minutes * 60;
                string = `${new_minutes}åˆ†${new_seconds}ç§’`;
            } else {
                new_seconds = total;
                string = `${new_seconds}ç§’`;
            }

            let score_count = Math.floor((100 / problem_counter) * (problem_counter - error_store.length));
            if(error_store.length == 0){
                string = `â±ï¸ åœ¨é•·é” ${string}çš„æ¸¬é©—ä¸­ï¼Œä¸€å…±ä½œç­”äº†${problem_counter}é¡Œï¼Œæ‚¨çš„ä½œç­”æƒ…æ³ç‚º`;
                // document.getElementById("error_problem_show").innerHTML = `ğŸ‰å…¨å°!!!ï¼Œæ­å–œä½ ç²å¾—100åˆ†`;
                let total_string = "";
                total_string += string;
                total_string += `ğŸ‰å…¨å°!!!ï¼Œæ­å–œä½ ç²å¾—100åˆ†`;
                display_string(total_string);
            } else {
                string = `â±ï¸ åœ¨é•·é” ${string}çš„æ¸¬é©—ä¸­ï¼Œä¸€å…±ä½œç­”äº†${problem_counter}é¡Œï¼Œæ‚¨çš„ä½œç­”æƒ…æ³ç‚ºé¡Œç›®æœ‰éŒ¯èª¤ï¼Œ`;
                error_show = `âŒ éŒ¯èª¤çš„é¡Œç›®å…±æœ‰ : ` + error_show;
                error_show = error_show + `ï¼Œæ­å–œä½ ç²å¾—${score_count}åˆ†ï¼Œå†æ¥å†å²!!!`;
                // document.getElementById("error_problem_show").innerHTML = error_show;
                let total_string = "";
                total_string += string;
                total_string += error_show;
                display_string(total_string);
            }
            // document.getElementById("user_time").innerHTML = string;
        }
        function display_string(total_string) {
            // content_total = total_string;
            // alert(content_total);
            read_the_content();
            let output = document.getElementById("user_time");
            let currentIndex = 0;


            let interval = setInterval(() => {
                if (currentIndex < total_string.length) {
                    // é¡¯ç¤ºå­—ä¸²ä¸­çš„ä¸€å€‹å­—å…ƒ
                    output.textContent += total_string[currentIndex];
                    // content_total = total_string[currentIndex];
                    // read_the_content();
                    currentIndex += 1; // ç§»å‹•åˆ°ä¸‹ä¸€å€‹å­—å…ƒ
                } else {
                    // ç•¶å­—ä¸²é¡¯ç¤ºå®Œå¾Œæ¸…é™¤ interval
                    clearInterval(interval);
                    read_the_content();
                }
            }, 100);
        }
        function read_the_content(){
            // let content = document.getElementById("content_one").innerText;
            const speech = new SpeechSynthesisUtterance(content_total);
            speech.lang = "zh-TW";
            window.speechSynthesis.speak(speech);
        }
    </script>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
